---
layout: post
categories: Software
title: 正则表达式的能力范围
description: 什么样的正则表达式可以判断JSON的合法性？什么？没有？是你写不出来吧，我去问别人。
---

实际项目中，

有很多需要**处理字符串**的场景，

判断用户输入的文本是否合法，

从一段文本中提取一些信息，

等等。

<br/>

正则表达式，

简直是神兵利器，

一般的问题，都可以轻易解决。

<br/>

然而，

**它也不是万能的**，

有着自身的能力范围。

<br/>

例如，

我们无法用正则表达式处理JSON，

无法用正则表达式分析HTML，

甚至无法从一段代码中把嵌套注释提取出来。

<br/>

是不是我们写的不好，

有没有精巧的写法，

来达到上述目的呢？

<br/>

一般而言，

要证明可以，只需要一个例子就行，

**而要证明不可以，就很难了**。

<br/>

所以，

我们要好好学习一下**理论基础**，

看一下正则表达式的真面目。

<br/>

## **形式语言**

日常生活中，

也有这样的认识，

我们所了解的汉字是**有限的**，

但是我们能说的话，却是**无限的**。

<br/>

因为，至少我们可以说出任意长度的汉字序列。

<br/>

程序语言也是如此。

<br/>

有人说编程，不就是输入A到Z吗，

指的就是这个编程语言的“字母表”，

字母表所包含的字母，是有限的，

但是可以写出无限多个“句子”。

<br/>

“语言”，正是这些“句子”的集合。

<br/>

事实上，

以上简短的描述中，

包含了很深刻的思想。

<br/>

当初，为了研究语言的性质，

人们从两个角度出发，

一个是从语言的识别角度来看，

有一套**自动机理论**。

<br/>

另一个是从语言的生成角度来看，

有乔姆斯基开创的**形式语言理论**。

<br/>

而这两个理论之间，

又是互相关联的。

<br/>

在形式语言理论中，

一个形式语言，

是一个字母表上的某些有限长字符串的集合。

<br/>

**这给了我们用有限来描述无限的能力**。

<br/>

## **文法**

为了描述语言的结构，

John Backus和Peter Naur创造了一种**语言的描述方法**，

称为BNF（Backus-Naur Form）。

<br/>

expr ::= term {"+" term | "-" term}.

term ::= factor {"*" factor | "/" factor}.

factor ::= "(" expr ")".

<br/>

BNF表示中的每一行，称为一个“产生式”，

::=表示左边的项可以由右边的项来产生。

其中，用引号括起来的项，称为“终结符”，相当于字面量。

不用引号括起来的项，称为“非终结符”，它们可以由其他项组成。

<br/>

{...}是约定好了的符号，

用来表示它包含的项可以出现0次或更多次。

<br/>

常用的还有[...]，

用来表示，可以出现也可以不出现。

<br/>

以上BNF描述了算术表达式的语法。

例如：1*(2+3)，可以从exp开始生成出来，

expr 

=> factor "*" factor

=> factor "*" "(" expr ")"

=> factor "*" "(" term "+" term ")"

=> 1 "*" "(" 2 "+" 3 ")"

<br/>

expr称为“开始符号”。

<br/>

综上，

一个语言的所有终结符，非终结符，产生式，开始符号，

构成了这个**语言的文法**。

<br/>

## **语言的分类**

乔姆斯基，根据语言文法产生式的特点，

把语言分为了4类。

<br/>

不同的文法，能描述不能范围的语言集合。

虽然它们都是无限集。

<br/>

0型文法，能力最强，可以产生递归可枚举语言。

1型文法，能力稍弱，可以产生上下文有关语言。

2型文法，能力次之，可以产生上下文无关语言。

3型文法，能力最弱，可以产生正则语言。

<br/>

这些文法，

建立了一个从大到小，互相包含的，

语言集合的层次关系。

<br/>

例如：

正则语言，一定是上下文无关语言，

反之，则不成立。

<br/>

其中，

2型和3型文法用的最多，有特殊的名字，

称为，**上下文无关文法**，**正则文法**。

<br/>

我们似乎发现了，

这里也出现了“正则”两个字，

难道与正则表达式有关？

<br/>

确实，

正则表达式，是正则文法的便利写法。

**正则表达式所描述的语言，是正则语言**。

<br/>

而JSON，HTML，包含嵌套注释文本，

它们都属于**上下文无关语言**，

正则表达式是无能为力的。

<br/>

那么如何判断语言不是正则语言呢？

这还需要用到[泵引理](http://baike.baidu.com/link?url=QF5rQxOWA6OA8NpOrQv3ThcPGZ2FF0Wzu7BWjwnLOtJE4AFgX2IN9pf6FWDVuOxV98GdMGWoHNMal5b61j7h__)这个重要工具。

水深危险。

<br/>

## **自动机**

自动机，是一种假想的机器，

常被人提及的是“图灵机”。

它是各种自动机中运算能力最强的机器。

<br/>

当初为了准确定义什么是“算法”，

图灵发明了它。

<br/>

图灵机有一条无限长的纸带，

纸带分成了一个个小方格，每个方格有不同的颜色。

有一个具有内部状态的机器头在纸带上移来移去。

<br/>

机器头根据自身状态和当前方格的颜色，

来决定下一步的位置。

<br/>

这么简易的装置，

居然具有和现代计算机同等的计算能力。

实际上，现代计算机就是从这个思想逐渐演化而来的。

<br/>

自动机，也可以用来识别语言。

而且，与形式语言还有着**优美的对应关系**。

<br/>

图灵机，能识别0型文法所生成的语言。

为图灵机加上限制，**下推自动机**，识别上下文无关语言，

**有穷自动机**，识别正则语言。

<br/>

在程序语言的编译器设计中，

这些理论是非常重要的。

<br/>

我们通过正则文法，构建有穷自动机，

对字符流进行**分词**（tokenize）。

通过上下文无关文法，构建下推自动机，

对词汇流进行**解析**（parse）。

<br/>

## **计算模型**

**形式语言**和**自动机**，

可以看做是两种**计算模型**，

它们从不同的角度描述了同一个问题。

<br/>

其他的计算模型，还有很多。

<br/>

**lambda演算**就是一个，

它是一个符号化的形式系统，

用来研究函数及其函数的调用。

<br/>

**递归函数论**，又是一个，

它从递归的角度，

为可计算性划分了界限。

<br/>

**命题逻辑**，也是，

它是逻辑系统的演算规则，

用来研究推理过程。

<br/>

然而，这些计算模型的计算能力，

都等价于图灵机。

<br/>

这一结论称为，Church-Turing论题。

<br/>

## **结语**

各种计算模型，虽然在能力上是相同的，

但是它们**各有所长**，

于是被用到了形形色色的地方。

<br/>

例如，

形式语言，可以用来研究语言的结构，

自动机，可以用来识别语言。

lambda演算，可以用来研究语言的操作语义。

递归函数论，可以用来研究语言的指称语义。

命题逻辑，可以用来研究语言的类型系统。

<br/>

编程世界，

原来这么好玩。

<br/>

其实编程，不就是输入A到Z吗？

<br/>

参考：

[数学.计算.逻辑](http://book.douban.com/subject/1709302/)

[形式语言与自动机理论](http://book.douban.com/subject/2179488/)

[A Mathematical Introduction to Logic](http://book.douban.com/subject/1729578/)

[Language Implementation Patterns](http://book.douban.com/subject/10482195/)

[编译器设计](http://book.douban.com/subject/20436488/)

[图灵的秘密](http://book.douban.com/subject/10779604/)

[Lambda-Calculus and Combinators](http://book.douban.com/subject/4323391/)

[Types and programming languages](http://book.douban.com/subject/1318672/)

[哥德尔.艾舍尔.巴赫_集异璧之大成](http://book.douban.com/subject/1291204/)
